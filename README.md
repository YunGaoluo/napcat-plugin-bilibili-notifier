# napcat-plugin-bilibili-notifier

📺 NapCat B站直播推送插件 - 实时监控主播开播状态，自动推送至QQ群和私聊。

## 功能特性

- **实时监控**：每10秒检查一次主播直播状态，及时推送开播/下播通知
- **群订阅**：支持群聊订阅主播，开播时自动发送到群内
- **私聊订阅**：支持用户私聊订阅，开播时私聊推送
- **@全体功能**：群订阅可开启开播@全体提醒
- **状态显示**：订阅列表显示主播当前直播状态和直播时长
- **权限管理**：群订阅仅管理员可操作

## 快速开始

### 安装

1. 下载 Release 中的 `napcat-plugin-bilibili-notifier.zip`
2. 解压到 NapCat 的 `plugins` 目录
3. 重启 NapCat 或在 WebUI 中启用插件

为什么不直接从 WebUi 中安装呢?

### 从源码构建

```bash
# 安装依赖
pnpm install

# 构建
pnpm run build

# 类型检查（可选）
npx tsc --noEmit
```

构建产物位于 `dist/index.mjs`。

## 使用说明

### 命令列表

所有命令以 `#blive` 为前缀：

| 命令 | 说明 | 使用场景 |
|-----|------|---------|
| `#blive help` | 显示帮助信息 | 任意 |
| `#blive 订阅 <UID>` | 订阅指定主播 | 群聊/私聊 |
| `#blive 删除 <UID>` | 取消订阅主播 | 群聊/私聊 |
| `#blive 列表` | 查看当前订阅列表 | 群聊/私聊 |
| `#blive atall on/off` | 开启/关闭开播@全体 | 仅群聊 |

### 使用示例

**订阅主播：**
```
#blive 订阅 123456
```

**查看订阅列表：**
```
#blive 列表
```

列表会显示：
- 主播昵称和UID
- 当前直播状态（未开播/直播中/轮播中）
- 直播时长（如果正在直播）
- 直播间链接

**开启@全体：**
```
#blive atall on
```

## 数据存储

插件使用 JSON 文件存储数据，位于插件数据目录：

| 文件 | 说明 |
|-----|------|
| `streamers.json` | 主播基本信息和直播状态 |
| `group_subs.json` | 群订阅配置 |
| `user_subs.json` | 用户订阅配置 |
| `live_cache.json` | 直播状态缓存 |

## 通知内容

### 开播通知

```
{主播名} 开播啦！
标题：{直播间标题}
分区: {父分区} - {子分区}
https://live.bilibili.com/{房间号}
[封面图]
```

### 下播通知

```
{主播名}下播了
本次直播时长: {时长}
```

## 注意事项

1. **权限要求**：群订阅/取消订阅需要群主或管理员权限
2. **UID获取**：在B站用户空间页面的URL中可以找到UID
3. **私聊订阅**：私聊订阅仅对该用户生效
4. **群订阅**：群订阅对该群所有成员可见，开播时发送到群内

## 开发

```bash
# 安装依赖
pnpm install

# 开发模式（监听文件变化）
pnpm run watch

# 构建
pnpm run build

# 类型检查
pnpm run typecheck
```

## 依赖

- `napcat-types` - NapCat 插件类型定义

## 许可证

MIT License
